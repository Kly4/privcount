# everybody needs these configs
global:
    ### epoch: 1 week
    epoch: 60 # the safe time frame of stats collection for all stats
    clock_skew: 3 # (300s) # deal with clock skews and latency
    q: 2147483647 # ((2**31)-1) 2^31 - 1 happens to be a prime

# only the tally server needs these
tally_server:
    publish_delay: 23 # clock_skew + 20 seconds
    listen_port: 20001 # open port on which to listen for remote connections from TKSes
    key: 'keys/tally.key' # path to the key file
    cert: 'keys/tally.cert' # path to the certificate file
    results: 'results.txt' # path to file where the results will be stored

# only the tally key servers needs these
tally_key_server:
    start_delay: 3 # seconds
    listen_port: 20002 # open port on which to listen for remote connections from DCs
    key: 'keys/tks.key' # path to the key file
    cert: 'keys/tks.cert' # path to the certificate file
    tally_server_info: # where the tally server is located
        ip: 127.0.0.1
        port: 20001

# only the data collectors needs these
data_collector:
    start_delay: 5 # seconds
    register_delay: 8 # start_delay + 3 seconds
    listen_port: 20003 # local port on which to listen for local connections from Tor
    noise_weight: 1.0 # distribute noise among all machines / data collectors
    tally_server_info: # where the tally server is located
        ip: 127.0.0.1
        port: 20001
    tally_key_server_infos: # where the tally key servers are located
        -
            ip: 127.0.0.1
            port: 20002

    statistics:
        ################
        # exit traffic #
        ################
        -
            type: 'Streams_Count'
            sigma: 1.0
        -
            # at least one stream completed on the circuit
            type: 'Circuits_Count' # the key for this stat
            sigma: 1.0 # the sigma for the global noise we want for privacy for this stat
        -
            # no streams completed on the circuit
            type: 'InactiveCircuits_Count'
            sigma: 1.0
        -
            # completed streams per active circuit
            type: 'WebStreamsPerCircuit_Histogram' ## combine http and https together!
            sigma: 1.0
            bins: '0, 2, 4'
        -
            # completed streams per active circuit
            type: 'InteractiveStreamsPerCircuit_Histogram' ## combine irc and ssh too!
            sigma: 1.0
            bins: '0, 2, 4'
        -
            # completed streams per active circuit
            type: 'P2PStreamsPerCircuit_Histogram' ## bittorrent! classify port >= 10000 as BT.
            sigma: 1.0
            bins: '0, 2, 4'
        -
            # completed streams per active circuit
            type: 'OtherStreamsPerCircuit_Histogram' ## classify port < 10000 and no other class.
            sigma: 1.0
            bins: '0, 2, 4'
        - ####### add an other category for everything else
            # bytes sent to server per completed stream
            type: 'WebBytesSentPerStream_Histogram'
            sigma: 1.0
            bins: '0, 2, 4'
        -
            # bytes sent to server per completed stream
            type: 'InteractiveBytesSentPerStream_Histogram'
            sigma: 1.0
            bins: '0, 2, 4'
        -
            # bytes sent to server per completed stream
            type: 'P2PBytesSentPerStream_Histogram'
            sigma: 1.0
            bins: '0, 2, 4'
        -
            # bytes received from server per completed stream
            type: 'WebBytesReceivedPerStream_Histogram'
            sigma: 1.0
            bins: '0, 2, 4'
        -
            # bytes received from server per completed stream
            type: 'InteractiveBytesReceivedPerStream_Histogram'
            sigma: 1.0
            bins: '0, 2, 4'
        -
            # bytes received from server per completed stream
            type: 'P2PBytesReceivedPerStream_Histogram'
            sigma: 1.0
            bins: '0, 2, 4'
        -
            # ratio of bytes sent to bytes received from server per completed stream
            type: 'WebBytesSentReceivedRatioPerStream_Histogram'
            sigma: 1.0
            bins: '0, 2, 4'
        -
            # ratio of bytes sent to bytes received from server per completed stream
            type: 'InteractiveBytesSentReceivedRatioPerStream_Histogram'
            sigma: 1.0
            bins: '0, 2, 4'
        -
            # ratio of bytes sent to bytes received from server per completed stream
            type: 'P2PBytesSentReceivedRatioPerStream_Histogram'
            sigma: 1.0
            bins: '0, 2, 4'
        -
            # time between create and destroy per completed stream
            type: 'WebStreamLifeTime_Histogram'
            sigma: 1.0
            bins: '0, 2, 4'
        -
            # time between create and destroy per completed stream
            type: 'InteractiveStreamLifeTime_Histogram'
            sigma: 1.0
            bins: '0, 2, 4'
        -
            # time between create and destroy per completed stream
            type: 'P2PStreamLifeTime_Histogram'
            sigma: 1.0
            bins: '0, 2, 4'
        -
            # time between creation of consecutive streams on the same circuit
            type: 'WebStreamIntercreationTime_Histogram'
            sigma: 1.0
            bins: '0, 2, 4'
        -
            # time between creation of consecutive streams on the same circuit
            type: 'InteractiveStreamIntercreationTime_Histogram'
            sigma: 1.0
            bins: '0, 2, 4'
        #################
        # entry traffic #
        #################
        # 10 minutes colleciton thing:
        # keep 2 dicts: prev 10 mins and current 10 mins
        # when a circ ends, if its lifetime is more than 10 minutes, add it to longedlive count
        # if less than 10 mins:
        #   add to current if it started in the current interval
        #   add it to prev if it started in the previous interval
        -
            # count over 10 minute intervals, then add to histogram counter
            type: 'UniqueClientIPs_Histogram'
            sigma: 1.0
        -
            # count over same 10 min intervals as client ips
            # number of circuits with at least 4096 bytes of transferred data per client IP
            type: 'CircuitsPerClientIP_Histogram'
            sigma: 1.0
            bins: '0, 2, 4'
        -
            # number of circuits with less than 4096 bytes of transferred data on client OR connections
            type: 'InactiveCircuitsPerClientIP_Histogram'
            sigma: 1.0
            bins: '0, 2, 4'
        -
            # number of OR connections to clients
            # to help understand churn - do unique clients come and go or do they stick around long
            type: 'Connections_Count'
            sigma: 1.0
        -
            # count number of circuits that were around for longer than the 10 minute collection period
            type: 'CircuitLifeTime_Histogram'
            sigma: 1.0
            bins: '0, 2, 4, 6, 8, 10, 12, 14, 16, 18, 20'
        -
            # bytes sent to client per circuit on client OR connections
            type: 'BytesSentPerCircuit_Histogram'
            sigma: 1.0
            bins: '0, 2, 4'
        -
            # bytes received from client per circuit on client OR connections
            type: 'BytesReceivedPerCircuit_Histogram'
            sigma: 1.0
            bins: '0, 2, 4'
        -
            # ratio of bytes sent to bytes received per circuit on client OR connections
            type: 'BytesSentReceivedRatioPerCircuit_Histogram'
            sigma: 1.0
            bins: '0, 2, 4'
